{"ast":null,"code":"import axios from 'axios';\nexport const GetJwtToken = () => localStorage.getItem('access_token');\n_c = GetJwtToken;\nexport const GetRefreshToken = () => localStorage.getItem('refresh_token');\n_c2 = GetRefreshToken;\nconst refreshAccessToken = async () => {\n  try {\n    console.log(GetRefreshToken());\n    const response = await axios.get('http://127.0.0.1:8000/', {\n      refresh: GetRefreshToken()\n    });\n    const newAccessToken = response.data.access;\n    localStorage.setItem('access_token', newAccessToken);\n    return newAccessToken;\n  } catch (error) {\n    console.error('Error refreshing access token:', error.message);\n    throw error;\n  }\n};\nexport const MakeAuthenticatedRequest = async (url, method = 'GET', data = null, requireAuth = true) => {\n  try {\n    let headers = requireAuth ? {\n      Authorization: `Bearer ${GetJwtToken()}`\n    } : {};\n    if (requireAuth && !headers.Authorization) {\n      throw new Error('No token found');\n    }\n    const config = {\n      method,\n      url,\n      headers,\n      ...(data && {\n        data\n      })\n    };\n    const response = await axios(config);\n    return response;\n  } catch (error) {\n    if (error.response && error.response.status === 401) {\n      try {\n        const newAccessToken = await refreshAccessToken();\n        const headers = {\n          Authorization: `Bearer ${newAccessToken}`\n        };\n        const config = {\n          method,\n          url,\n          headers,\n          ...(data && {\n            data\n          })\n        };\n        const response = await axios(config);\n        return response;\n      } catch (refreshError) {\n        console.error('Refresh token error:', refreshError.message);\n        throw refreshError; // Propagate the error if refresh fails\n      }\n    } else {\n      console.error('Error in authenticated request:', error.message);\n      throw error; // Re-throw other errors\n    }\n  }\n};\n_c3 = MakeAuthenticatedRequest;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"GetJwtToken\");\n$RefreshReg$(_c2, \"GetRefreshToken\");\n$RefreshReg$(_c3, \"MakeAuthenticatedRequest\");","map":{"version":3,"names":["axios","GetJwtToken","localStorage","getItem","_c","GetRefreshToken","_c2","refreshAccessToken","console","log","response","get","refresh","newAccessToken","data","access","setItem","error","message","MakeAuthenticatedRequest","url","method","requireAuth","headers","Authorization","Error","config","status","refreshError","_c3","$RefreshReg$"],"sources":["/Users/ayanjitdutta/to-do-list/frontend_todo/src/APIHelper.jsx"],"sourcesContent":["import axios from 'axios';\n\nexport const GetJwtToken = () => localStorage.getItem('access_token');\nexport const GetRefreshToken = () => localStorage.getItem('refresh_token');\n\nconst refreshAccessToken = async () => {\n    try {\n        console.log( GetRefreshToken())\n        const response = await axios.get('http://127.0.0.1:8000/', {\n            refresh: GetRefreshToken(),\n        });\n        \n        const newAccessToken = response.data.access;\n        localStorage.setItem('access_token', newAccessToken);\n        return newAccessToken;\n    } catch (error) {\n        console.error('Error refreshing access token:', error.message);\n        throw error;\n    }\n};\n\nexport const MakeAuthenticatedRequest = async (url, method = 'GET', data = null, requireAuth = true) => {\n    try {\n        let headers = requireAuth ? { Authorization: `Bearer ${GetJwtToken()}` } : {};\n\n        if (requireAuth && !headers.Authorization) {\n            throw new Error('No token found');\n        }\n        const config = {\n            method,\n            url,\n            headers,\n            ...(data && { data }),\n        };\n\n        const response = await axios(config);\n        return response;\n        \n    } catch (error) {\n        if (error.response && error.response.status === 401) {\n\n            try {\n                const newAccessToken = await refreshAccessToken();\n                \n                const headers = { Authorization: `Bearer ${newAccessToken}` };\n                const config = {\n                    method,\n                    url,\n                    headers,\n                    ...(data && { data }),\n                };\n                \n                const response = await axios(config);\n                return response;\n            } catch (refreshError) {\n                console.error('Refresh token error:', refreshError.message);\n                throw refreshError; // Propagate the error if refresh fails\n            }\n        } else {\n            console.error('Error in authenticated request:', error.message);\n            throw error; // Re-throw other errors\n        }\n    }\n};\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,OAAO,MAAMC,WAAW,GAAGA,CAAA,KAAMC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;AAACC,EAAA,GAAzDH,WAAW;AACxB,OAAO,MAAMI,eAAe,GAAGA,CAAA,KAAMH,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC;AAACG,GAAA,GAA9DD,eAAe;AAE5B,MAAME,kBAAkB,GAAG,MAAAA,CAAA,KAAY;EACnC,IAAI;IACAC,OAAO,CAACC,GAAG,CAAEJ,eAAe,CAAC,CAAC,CAAC;IAC/B,MAAMK,QAAQ,GAAG,MAAMV,KAAK,CAACW,GAAG,CAAC,wBAAwB,EAAE;MACvDC,OAAO,EAAEP,eAAe,CAAC;IAC7B,CAAC,CAAC;IAEF,MAAMQ,cAAc,GAAGH,QAAQ,CAACI,IAAI,CAACC,MAAM;IAC3Cb,YAAY,CAACc,OAAO,CAAC,cAAc,EAAEH,cAAc,CAAC;IACpD,OAAOA,cAAc;EACzB,CAAC,CAAC,OAAOI,KAAK,EAAE;IACZT,OAAO,CAACS,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAACC,OAAO,CAAC;IAC9D,MAAMD,KAAK;EACf;AACJ,CAAC;AAED,OAAO,MAAME,wBAAwB,GAAG,MAAAA,CAAOC,GAAG,EAAEC,MAAM,GAAG,KAAK,EAAEP,IAAI,GAAG,IAAI,EAAEQ,WAAW,GAAG,IAAI,KAAK;EACpG,IAAI;IACA,IAAIC,OAAO,GAAGD,WAAW,GAAG;MAAEE,aAAa,EAAE,UAAUvB,WAAW,CAAC,CAAC;IAAG,CAAC,GAAG,CAAC,CAAC;IAE7E,IAAIqB,WAAW,IAAI,CAACC,OAAO,CAACC,aAAa,EAAE;MACvC,MAAM,IAAIC,KAAK,CAAC,gBAAgB,CAAC;IACrC;IACA,MAAMC,MAAM,GAAG;MACXL,MAAM;MACND,GAAG;MACHG,OAAO;MACP,IAAIT,IAAI,IAAI;QAAEA;MAAK,CAAC;IACxB,CAAC;IAED,MAAMJ,QAAQ,GAAG,MAAMV,KAAK,CAAC0B,MAAM,CAAC;IACpC,OAAOhB,QAAQ;EAEnB,CAAC,CAAC,OAAOO,KAAK,EAAE;IACZ,IAAIA,KAAK,CAACP,QAAQ,IAAIO,KAAK,CAACP,QAAQ,CAACiB,MAAM,KAAK,GAAG,EAAE;MAEjD,IAAI;QACA,MAAMd,cAAc,GAAG,MAAMN,kBAAkB,CAAC,CAAC;QAEjD,MAAMgB,OAAO,GAAG;UAAEC,aAAa,EAAE,UAAUX,cAAc;QAAG,CAAC;QAC7D,MAAMa,MAAM,GAAG;UACXL,MAAM;UACND,GAAG;UACHG,OAAO;UACP,IAAIT,IAAI,IAAI;YAAEA;UAAK,CAAC;QACxB,CAAC;QAED,MAAMJ,QAAQ,GAAG,MAAMV,KAAK,CAAC0B,MAAM,CAAC;QACpC,OAAOhB,QAAQ;MACnB,CAAC,CAAC,OAAOkB,YAAY,EAAE;QACnBpB,OAAO,CAACS,KAAK,CAAC,sBAAsB,EAAEW,YAAY,CAACV,OAAO,CAAC;QAC3D,MAAMU,YAAY,CAAC,CAAC;MACxB;IACJ,CAAC,MAAM;MACHpB,OAAO,CAACS,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAACC,OAAO,CAAC;MAC/D,MAAMD,KAAK,CAAC,CAAC;IACjB;EACJ;AACJ,CAAC;AAACY,GAAA,GA1CWV,wBAAwB;AAAA,IAAAf,EAAA,EAAAE,GAAA,EAAAuB,GAAA;AAAAC,YAAA,CAAA1B,EAAA;AAAA0B,YAAA,CAAAxB,GAAA;AAAAwB,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}