{"ast":null,"code":"import axios from 'axios';\nexport const GetJwtToken = () => localStorage.getItem('access_token');\n_c = GetJwtToken;\nexport const GetRefreshToken = () => localStorage.getItem('refresh_token');\n_c2 = GetRefreshToken;\nconst refreshAccessToken = async () => {\n  try {\n    const response = await axios.post('http://127.0.0.1:8000/refresh/', {\n      refresh: GetRefreshToken()\n    });\n\n    // Assuming the response contains the new access token\n    const newAccessToken = response.data.access; // Adjust according to your API response structure\n    localStorage.setItem('access_token', newAccessToken);\n    return newAccessToken;\n  } catch (error) {\n    console.error('Error refreshing access token:', error.message);\n    throw error;\n  }\n};\nexport const MakeAuthenticatedRequest = async (url, method = 'GET', data = null, requireAuth = true) => {\n  try {\n    let headers = requireAuth ? {\n      Authorization: `Bearer ${GetJwtToken()}`\n    } : {};\n    if (requireAuth && !headers.Authorization) {\n      throw new Error('No token found');\n    }\n    const config = {\n      method,\n      url,\n      headers,\n      ...(data && {\n        data\n      })\n    };\n    const response = await axios(config);\n    return response;\n  } catch (error) {\n    if (error.response && error.response.status === 401) {\n      // Handle expired token by trying to refresh it\n      try {\n        const newAccessToken = await refreshAccessToken();\n\n        // Retry the original request with the new token\n        const headers = {\n          Authorization: `Bearer ${newAccessToken}`\n        };\n        const config = {\n          method,\n          url,\n          headers,\n          ...(data && {\n            data\n          })\n        };\n        const response = await axios(config);\n        return response;\n      } catch (refreshError) {\n        console.error('Refresh token error:', refreshError.message);\n        throw refreshError; // Propagate the error if refresh fails\n      }\n    } else {\n      console.error('Error in authenticated request:', error.message);\n      throw error; // Re-throw other errors\n    }\n  }\n};\n_c3 = MakeAuthenticatedRequest;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"GetJwtToken\");\n$RefreshReg$(_c2, \"GetRefreshToken\");\n$RefreshReg$(_c3, \"MakeAuthenticatedRequest\");","map":{"version":3,"names":["axios","GetJwtToken","localStorage","getItem","_c","GetRefreshToken","_c2","refreshAccessToken","response","post","refresh","newAccessToken","data","access","setItem","error","console","message","MakeAuthenticatedRequest","url","method","requireAuth","headers","Authorization","Error","config","status","refreshError","_c3","$RefreshReg$"],"sources":["/Users/ayanjitdutta/to-do-list/frontend_todo/src/APIHelper.jsx"],"sourcesContent":["import axios from 'axios';\n\nexport const GetJwtToken = () => localStorage.getItem('access_token');\nexport const GetRefreshToken = () => localStorage.getItem('refresh_token');\n\nconst refreshAccessToken = async () => {\n    try {\n        const response = await axios.post('http://127.0.0.1:8000/refresh/', {\n            refresh: GetRefreshToken(),\n        });\n        \n        // Assuming the response contains the new access token\n        const newAccessToken = response.data.access; // Adjust according to your API response structure\n        localStorage.setItem('access_token', newAccessToken);\n        return newAccessToken;\n    } catch (error) {\n        console.error('Error refreshing access token:', error.message);\n        throw error;\n    }\n};\n\nexport const MakeAuthenticatedRequest = async (url, method = 'GET', data = null, requireAuth = true) => {\n    try {\n        let headers = requireAuth ? { Authorization: `Bearer ${GetJwtToken()}` } : {};\n\n        if (requireAuth && !headers.Authorization) {\n            throw new Error('No token found');\n        }\n\n        const config = {\n            method,\n            url,\n            headers,\n            ...(data && { data }),\n        };\n\n        const response = await axios(config);\n        return response;\n        \n    } catch (error) {\n        if (error.response && error.response.status === 401) {\n            // Handle expired token by trying to refresh it\n            try {\n                const newAccessToken = await refreshAccessToken();\n                \n                // Retry the original request with the new token\n                const headers = { Authorization: `Bearer ${newAccessToken}` };\n                const config = {\n                    method,\n                    url,\n                    headers,\n                    ...(data && { data }),\n                };\n                \n                const response = await axios(config);\n                return response;\n            } catch (refreshError) {\n                console.error('Refresh token error:', refreshError.message);\n                throw refreshError; // Propagate the error if refresh fails\n            }\n        } else {\n            console.error('Error in authenticated request:', error.message);\n            throw error; // Re-throw other errors\n        }\n    }\n};\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,OAAO,MAAMC,WAAW,GAAGA,CAAA,KAAMC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;AAACC,EAAA,GAAzDH,WAAW;AACxB,OAAO,MAAMI,eAAe,GAAGA,CAAA,KAAMH,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC;AAACG,GAAA,GAA9DD,eAAe;AAE5B,MAAME,kBAAkB,GAAG,MAAAA,CAAA,KAAY;EACnC,IAAI;IACA,MAAMC,QAAQ,GAAG,MAAMR,KAAK,CAACS,IAAI,CAAC,gCAAgC,EAAE;MAChEC,OAAO,EAAEL,eAAe,CAAC;IAC7B,CAAC,CAAC;;IAEF;IACA,MAAMM,cAAc,GAAGH,QAAQ,CAACI,IAAI,CAACC,MAAM,CAAC,CAAC;IAC7CX,YAAY,CAACY,OAAO,CAAC,cAAc,EAAEH,cAAc,CAAC;IACpD,OAAOA,cAAc;EACzB,CAAC,CAAC,OAAOI,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAACE,OAAO,CAAC;IAC9D,MAAMF,KAAK;EACf;AACJ,CAAC;AAED,OAAO,MAAMG,wBAAwB,GAAG,MAAAA,CAAOC,GAAG,EAAEC,MAAM,GAAG,KAAK,EAAER,IAAI,GAAG,IAAI,EAAES,WAAW,GAAG,IAAI,KAAK;EACpG,IAAI;IACA,IAAIC,OAAO,GAAGD,WAAW,GAAG;MAAEE,aAAa,EAAE,UAAUtB,WAAW,CAAC,CAAC;IAAG,CAAC,GAAG,CAAC,CAAC;IAE7E,IAAIoB,WAAW,IAAI,CAACC,OAAO,CAACC,aAAa,EAAE;MACvC,MAAM,IAAIC,KAAK,CAAC,gBAAgB,CAAC;IACrC;IAEA,MAAMC,MAAM,GAAG;MACXL,MAAM;MACND,GAAG;MACHG,OAAO;MACP,IAAIV,IAAI,IAAI;QAAEA;MAAK,CAAC;IACxB,CAAC;IAED,MAAMJ,QAAQ,GAAG,MAAMR,KAAK,CAACyB,MAAM,CAAC;IACpC,OAAOjB,QAAQ;EAEnB,CAAC,CAAC,OAAOO,KAAK,EAAE;IACZ,IAAIA,KAAK,CAACP,QAAQ,IAAIO,KAAK,CAACP,QAAQ,CAACkB,MAAM,KAAK,GAAG,EAAE;MACjD;MACA,IAAI;QACA,MAAMf,cAAc,GAAG,MAAMJ,kBAAkB,CAAC,CAAC;;QAEjD;QACA,MAAMe,OAAO,GAAG;UAAEC,aAAa,EAAE,UAAUZ,cAAc;QAAG,CAAC;QAC7D,MAAMc,MAAM,GAAG;UACXL,MAAM;UACND,GAAG;UACHG,OAAO;UACP,IAAIV,IAAI,IAAI;YAAEA;UAAK,CAAC;QACxB,CAAC;QAED,MAAMJ,QAAQ,GAAG,MAAMR,KAAK,CAACyB,MAAM,CAAC;QACpC,OAAOjB,QAAQ;MACnB,CAAC,CAAC,OAAOmB,YAAY,EAAE;QACnBX,OAAO,CAACD,KAAK,CAAC,sBAAsB,EAAEY,YAAY,CAACV,OAAO,CAAC;QAC3D,MAAMU,YAAY,CAAC,CAAC;MACxB;IACJ,CAAC,MAAM;MACHX,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAACE,OAAO,CAAC;MAC/D,MAAMF,KAAK,CAAC,CAAC;IACjB;EACJ;AACJ,CAAC;AAACa,GAAA,GA5CWV,wBAAwB;AAAA,IAAAd,EAAA,EAAAE,GAAA,EAAAsB,GAAA;AAAAC,YAAA,CAAAzB,EAAA;AAAAyB,YAAA,CAAAvB,GAAA;AAAAuB,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}